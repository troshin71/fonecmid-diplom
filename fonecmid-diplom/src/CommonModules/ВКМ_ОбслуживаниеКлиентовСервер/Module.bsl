#Область ОбработчикиПодписокНаСобытия

// Обработчик подписки "ВКМ_ЗаписьДокументаОбслуживания"
// Событие: ПередЗаписью (или ПриЗаписи)
// Источник: ДокументОбъект.ВКМ_ОбслуживаниеКлиента
Процедура ВКМ_ЗаписьДокументаОбслуживанияПриЗаписи(Источник, Отказ) Экспорт
	
	// 1. Технические проверки: не загрузка ли это?
	If Источник.ОбменДанными.Загрузка Then
		Return;
	EndIf;
	
	// 2. Логика: Если документ Новый ИЛИ изменился Специалист
	// Для "ЭтоНовый()" подписка должна быть "ПередЗаписью". 
	// Если подписка "ПриЗаписи" - ЭтоНовый() уже вернет Ложь (так как записано).
	
	// ВАЖНО: Если ты выбрал событие "ПриЗаписи", используй такую логику:
	// Нам нужно понять, что это новая заявка. В рамках диплома часто упрощают 
	// и просто отправляют уведомление всегда или проверяют пометку удаления.
	
	// Давай сделаем универсально для события "ПередЗаписью":
	Если Источник.ЭтоНовый() ИЛИ (Источник.Ссылка.Специалист <> Источник.Специалист) Тогда
		
		ТекстСообщения = "Новая заявка на обслуживание!" + Символы.ПС +
		                 "Клиент: " + Источник.ВКМ_Клиент + Символы.ПС +
		                 "Описание: " + Источник.ВКМ_ОписаниеПроблемы;
		
		// Создаем запись в справочнике-очереди
		Уведомление = Справочники.ВКМ_УведомленияТелеграмБоту.СоздатьЭлемент();
		Уведомление.ВКМ_ТекстСообщения = ТекстСообщения;
		Уведомление.Записать();
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти