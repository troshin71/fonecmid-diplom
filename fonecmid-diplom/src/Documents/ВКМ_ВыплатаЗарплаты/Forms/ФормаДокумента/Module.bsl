
&НаСервере
Процедура ЗаполнитьНаСервере()
	
// 1. Проверяем, есть ли вообще записи в регистре (независимо от даты)
	// Это чисто для проверки
	ЗапросПроверка = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 1 * ИЗ РегистрНакопления.ВКМ_ВзаиморасчетыССотрудниками");
	Если ЗапросПроверка.Выполнить().Пустой() Тогда
		Сообщить("ОШИБКА: Регистр Взаиморасчетов пуст! Перепроведите документ Начисления Зарплаты.");
		Возврат;
	КонецЕсли;

	// 2. Основной запрос остатков
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.ВКМ_Сотрудник КАК Сотрудник,
	|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.ВКМ_СуммаОстаток КАК Сумма
	|ИЗ
	|	РегистрНакопления.ВКМ_ВзаиморасчетыССотрудниками.Остатки(&Период,) КАК ВКМ_ВзаиморасчетыССотрудникамиОстатки
	|ГДЕ
	|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.ВКМ_СуммаОстаток > 0";
	
	Запрос.УстановитьПараметр("Период", Объект.Дата);
	
	Результат = Запрос.Выполнить();
	
	If Результат.Пустой() Тогда
		Сообщить("Внимание: На дату " + Объект.Дата + " долгов перед сотрудниками не найдено.");
	Иначе
		Выгрузка = Результат.Выгрузить();
		Сообщить("Найдено сотрудников к выплате: " + Выгрузка.Количество());
		Объект.Выплаты.Загрузить(Выгрузка);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Заполнить(Команда)
	ЗаполнитьНаСервере();
КонецПроцедуры
